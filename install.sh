#! /bin/bash

echo -e "                             ⢀⣀⣀⡀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢰⣿⣿⣿⣿⡄⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠘⣿⣿⣿⡿⠃⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠉⠉⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣀⣤⣶⣶⣶⣶⣶⣦⣤⣀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣠⣾⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣷⣄⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠈⢷⣤⣄⣀⡀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣀⠀⣼⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣆⠀⣀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢀⣀⣤⣴⡞⠁⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠈⢿⣿⣿⣷⠀⠀⠀⠀⣤⣴⣶⣿⣿⠇⢸⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⡄⢹⣿⣷⣶⣦⣤⠀⠀⠀⢀⣿⣿⣿⡟⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠠⣤⣤⣤⣼⣿⡿⣡⡶⢀⣀⣀⣿⣿⣿⣿⡟⠀⢸⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⡇⠀⢿⣿⣿⣿⣿⣀⣀⡰⣶⡝⣿⣿⣤⣤⣤⡤⠄⠀⠀⠀⠀
⠀⠀⠀⡀⠀⠀⠀⠀⠀⠀⠀⠈⣴⣿⣿⣿⣿⠟⠛⠛⠁⠀⠈⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⠀⠀⠘⠛⠛⢻⣿⣿⣿⣿⣎⠁⠀⠀⠀⠀⠀⠀⠀⣀⠀⠀⠀
⠀⠀⠀⣿⣦⣄⠀⠀⠀⠀⠀⢠⣿⣿⣿⣿⠟⣠⠀⠀⠀⠀⠀⣿⠛⠙⠻⠿⣿⣿⣿⣿⣿⡿⠿⠛⠋⢻⣇⠀⠀⠀⠀⢀⣌⠻⣿⣿⣿⣿⡀⠀⠀⠀⠀⢀⣠⣾⣿⠀⠀⠀
⠀⠀⠀⢿⣿⣿⣿⣶⣦⣤⣴⣿⣿⣿⠟⠃⠺⢋⣴⣄⠀⠀⠀⣿⡆⠀⠀⠀⠀⢹⣿⣿⡇⠀⠀⠀⠀⣸⣿⠀⠀⢀⣴⣮⡻⠇⠙⢿⣿⣿⣷⣤⣤⣴⣾⣿⣿⣿⡇⠀⠀⠀
⠀⠀⠀⠘⣿⣿⣿⣿⣿⣿⣿⣿⣿⡇⠀⠀⠀⠈⠻⣿⣷⣄⠀⢻⣿⣶⣤⣤⣶⡿⠟⠻⣿⣶⣤⣤⣾⣿⠏⢀⣴⣿⡿⠋⠀⠀⠀⠀⣿⣿⣿⣿⣿⣿⣿⣿⣿⡿⠁⠀⠀⠀
⠀⠀⠀⠀⠘⢿⣿⣿⣿⣿⣿⣿⣿⣿⣶⣤⠀⠀⠀⠈⠻⣿⣷⣄⠙⢿⣿⣿⣿⡁⢰⡀⢸⣿⣿⣿⡿⢃⣴⣿⡿⠋⠀⠀⠀⠀⣤⣾⣿⣿⣿⣿⣿⣿⣿⣿⡿⠁⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠙⢿⣿⣿⣿⣿⣿⣿⣿⣿⡀⠀⠀⠀⠀⠈⠛⢿⣷⣦⡻⣿⣿⣿⣿⣿⣿⣿⡿⢋⣴⣿⡿⠋⠀⠀⠀⠀⠀⢠⣿⣿⣿⣿⣿⣿⣿⣿⡿⠋⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠈⠙⠛⠿⠿⠿⠿⠿⠿⠄⠀⠀⠀⠀⠀⠀⠙⢿⣿⣮⠻⣿⣿⣿⣿⢏⣴⣿⡿⠋⠀⠀⠀⠀⠀⠀⠴⠿⠿⠿⠿⠿⠿⠛⠋⠁⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠙⢿⣷⣌⠻⢟⣵⣿⡿⠋⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠙⣿⣷⣾⡿⠋⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢀⣤⣾⣿⡿⢿⣿⣷⣄⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣠⣴⣿⣿⠟⠁⠀⠀⠙⠿⣿⣿⣦⣀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠰⣾⣿⡿⠟⠁⠀⠀⠀⠀⠀⠀⠈⠻⣿⣿⣷⠄⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠈⠋⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠈⠛⠁⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
"

source ./scripts/deliver.sh
source ./scripts/distro.sh

GREEN='\033[1;32m'
RED='\033[1;31m'
NC='\033[0m'
DISTRO_UGLY=$(getDistro)
DISTRO="${DISTRO_UGLY,,}"

# distro packages
if [[ $DISTRO == *"manjaro"* ]] then
    echo -e "${GREEN}>>>>> Found $DISTRO_UGLY using pacman <<<<<${NC}"

    # install with pacman
    yes | sudo pacman -Syu
    yes | sudo pacman -S wget ufw gufw ufw-extras neofetch vim openconnect python-pygments nodejs npm curl systemctl
    yes | sudo pamac install flatpak libpamac-flatpak-plugin

    # install flatpaks
    sudo flatpak install flathub us.zoom.Zoom -y
    sudo flatpak install flathub com.slack.Slack -y
    sudo flatpak install flathub com.visualstudio.code -y
    sudo flatpak install flathub com.vivaldi.Vivaldi -y
    sudo flatpak install flathub com.discordapp.Discord -y
    sudo flatpak install flathub org.libreoffice.LibreOffice -y
    sudo flatpak install flathub com.google.Chrome -y
    sudo flatpak install flathub org.mozilla.firefox -y

    # install vscode extensions
    source ./scripts/flatpak-vscode-extensions.sh

elif [[ $DISTRO == *"ubuntu"* ]]; then
    echo -e "${GREEN}>>>>> Found $DISTRO_UGLY using apt <<<<<${NC}"

    # remove snap and stop from auto install snaps
    sudo apt autoremove --purge snapd
    sudo apt-mark hold snapd
    sudo apt install gnome-software --no-install-recommends -y

    # install with apt
    sudo apt update && sudo apt upgrade
    sudo apt install wget ufw gufw ufw-extras neofetch vim openconnect python-pygments nodejs npm curl -y
    sudo apt install dirmngr software-properties-common apt-transport-https curl ca-certificates -y
    sudo apt install libegl1-mesa libxcb-cursor0 libxcb-xtest0 systemctl -y

    # vivaldi
    curl -fsSL https://repo.vivaldi.com/archive/linux_signing_key.pub | gpg --dearmor | sudo tee /usr/share/keyrings/vivaldi.gpg > /dev/null
    echo deb [arch=amd64,armhf signed-by=/usr/share/keyrings/vivaldi.gpg] https://repo.vivaldi.com/archive/deb/ stable main | sudo tee /etc/apt/sources.list.d/vivaldi.list
    sudo apt update
    sudo apt install vivaldi-stable

    # vscode
    curl -fSsL https://packages.microsoft.com/keys/microsoft.asc | gpg --dearmor | sudo tee /usr/share/keyrings/vscode.gpg >/dev/null
    echo deb [arch=amd64 signed-by=/usr/share/keyrings/vscode.gpg] https://packages.microsoft.com/repos/vscode stable main | sudo tee /etc/apt/sources.list.d/vscode.list

    sudo apt update
    sudo apt install code

    # warp | zoom | slack | discord |
    wget 'https://app.warp.dev/download?package=deb' -O ~/Downloads/warp.deb
    wget 'https://zoom.us/client/latest/zoom_amd64.deb' -O ~/Downloads/zoom.deb
    wget 'https://downloads.slack-edge.com/releases/linux/4.36.140/prod/x64/slack-desktop-4.36.140-amd64.deb' -O ~/Downloads/slack.deb
    wget 'https://discord.com/api/download?platform=linux&format=deb' -O ~/Downloads/discord.deb

    sudo apt install ~/Downloads/warp.deb
    sudo apt install ~/Downloads/slack.deb
    sudo apt install ~/Downloads/zoom.deb
    sudo apt install ~/Downloads/discord.deb
else
    echo -e "${RED}>>>>> Distro unknown exiting install <<<<<${NC}"

    exit
fi

# nvm
wget -qO- https://raw.githubusercontent.com/nvm-sh/nvm/v0.39.7/install.sh | bash

nvm install 21.6.0

# uncomplicated firewall
sudo systemctl enable ufw
sudo systemctl start ufw
sudo ufw limit 22/tcp
sudo ufw allow 80/tcp
sudo ufw allow 443/tcp
sudo ufw default deny incoming
sudo ufw default allow outgoing

echo -e "${RED}>>>>> Uncomplicated Firewall Status <<<<<${NC}"
sudo ufw status

# reboot or exit
echo -e "${GREEN}>>>>> System Setup Finished <<<<<${NC}"

read -r -p "Reboot? [Y/n] " response
if [[ "$response" == "y" ]] || [[ "$response" == "Y" ]]
then
    sudo poweroff
elif [[ "$response" == "n" ]] || [[ "$response" == "N" ]]
then
    exit 1
fi
